@page "/docs"
@using MyApplication.Services
@using Microsoft.JSInterop
@inject AuthService AuthService
@inject NavigationManager Navigation
@inject IJSRuntime JSRuntime
@layout MyApplication.Components.Layout.MainLayout
@implements IAsyncDisposable

<PageTitle>Documentation - ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏°‡∏µ‡∏¢</PageTitle>

@if (!AuthService.IsAuthenticated)
{
    <MudAlert Severity="Severity.Warning" Class="mb-4">
        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    </MudAlert>
    Navigation.NavigateTo("/login");
    return;
}

@if (AuthService.CurrentUser?.Role != "‡πÄ‡∏°‡∏µ‡∏¢")
{
    <MudContainer MaxWidth="MaxWidth.Medium" Class="pt-16">
        <MudPaper Elevation="3" Class="pa-8 text-center">
            <MudIcon Icon="@Icons.Material.Filled.Block" Size="Size.Large" Color="Color.Error" />
            <MudText Typo="Typo.h5" Color="Color.Error" Class="mb-4">
                ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á
            </MudText>
            <MudText Typo="Typo.body1">
                ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏µ‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô! üëë<br/>
                ‡∏™‡∏≤‡∏°‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏î‡∏π üòÖ
            </MudText>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" Href="/dashboard" Class="mt-4">
                ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Dashboard
            </MudButton>
        </MudPaper>
    </MudContainer>
    return;
}

<MudContainer MaxWidth="MaxWidth.ExtraLarge">
    <MudPaper Elevation="3" Class="pa-6" Style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <MudStack Spacing="4">
            <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                <MudIcon Icon="@Icons.Material.Filled.Description" Size="Size.Large" Color="Color.Warning" />
                <MudText Typo="Typo.h4" Color="Color.Warning">
                    üìö Documentation - ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏°‡∏µ‡∏¢
                </MudText>
            </MudStack>

            <MudAlert Severity="Severity.Info" Icon="@Icons.Material.Filled.Info">
                <MudText>
                    ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö (‡πÄ‡∏°‡∏µ‡∏¢) üíï
                </MudText>
            </MudAlert>

            <!-- Tabs -->
            <MudTabs Elevation="3" Rounded="true" Color="Color.Primary" PanelClass="pa-6" ActivePanelIndex="@activeTabIndex" ActivePanelIndexChanged="@OnTabChanged">
                
                <!-- API Documentation Tab -->
                <MudTabPanel Text="üîó API Documentation">
                    <MudStack Spacing="4">
                        <MudText Typo="Typo.h5" Color="Color.Primary">
                            API Specification - ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏°‡∏µ‡∏¢
                        </MudText>
                        
                        <MudText Typo="Typo.body1">
                            <strong>Base URL:</strong> https://wife-permission-system.com/api/v1
                        </MudText>

                        <!-- Authentication -->
                        <MudExpansionPanels Elevation="3">
                            <MudExpansionPanel>
                                <TitleContent>
                                    <div style="display: flex; align-items: center;">
                                        <MudIcon Icon="@Icons.Material.Filled.Security" class="mr-3" />
                                        <MudText>üîê Authentication</MudText>
                                    </div>
                                </TitleContent>
                                <ChildContent>
                                    <MudStack Spacing="2">
                                        <MudText Typo="Typo.h6">POST /auth/login</MudText>
                                        <MudPaper Class="pa-2" Style="background-color: #f5f5f5; font-family: 'Courier New', monospace;">
                                            <pre style="margin: 0; white-space: pre-wrap;"><code>
{
  "username": "string",
  "password": "string"
}

Response:
{
  "token": "jwt_token_here",
  "user": {
    "id": 1,
    "username": "‡πÄ‡∏°‡∏µ‡∏¢",
    "displayName": "‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏°‡∏µ‡∏¢",
    "role": "‡πÄ‡∏°‡∏µ‡∏¢"
  }
}
                                            </code></pre>
                                        </MudPaper>
                                        
                                        <MudText Typo="Typo.h6">POST /auth/logout</MudText>
                                        <MudPaper Class="pa-2" Style="background-color: #f5f5f5; font-family: 'Courier New', monospace;">
                                            <pre style="margin: 0; white-space: pre-wrap;"><code>
Response: 
{
  "message": "Logged out successfully"
}
                                            </code></pre>
                                        </MudPaper>
                                    </MudStack>
                                </ChildContent>
                            </MudExpansionPanel>

                            <MudExpansionPanel>
                                <TitleContent>
                                    <div style="display: flex; align-items: center;">
                                        <MudIcon Icon="@Icons.Material.Filled.Assignment" class="mr-3" />
                                        <MudText>üìù Requests API</MudText>
                                    </div>
                                </TitleContent>
                                <ChildContent>
                                    <MudStack Spacing="3">
                                        <MudText Typo="Typo.h6">GET /requests</MudText>
                                        <MudText Typo="Typo.body2">‡∏î‡∏∂‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (Admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)</MudText>
                                        <MudPaper Class="pa-2" Style="background-color: #f5f5f5; font-family: 'Courier New', monospace;">
                                            <pre style="margin: 0; white-space: pre-wrap;"><code>
Response:
[
  {
    "id": 1,
    "name": "‡∏ß‡∏±‡∏¢‡∏ß‡∏≤‡∏¢",
    "date": "2025-06-15",
    "time": "18:00",
    "place": "‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏∞",
    "reason": "‡∏ô‡∏±‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏°‡∏±‡∏¢‡∏°‡∏±‡∏ò‡∏¢‡∏°",
    "status": "‡∏£‡∏≠",
    "createdDate": "2025-06-14T10:00:00Z"
  }
]
                                            </code></pre>
                                        </MudPaper>

                                        <MudText Typo="Typo.h6">GET /requests/user/{username}</MudText>
                                        <MudText Typo="Typo.body2">‡∏î‡∏∂‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ô‡∏ô‡∏±‡πâ‡∏ô</MudText>

                                        <MudText Typo="Typo.h6">POST /requests</MudText>
                                        <MudText Typo="Typo.body2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏´‡∏°‡πà</MudText>
                                        <MudPaper Class="pa-2" Style="background-color: #f5f5f5; font-family: 'Courier New', monospace;">
                                            <pre style="margin: 0; white-space: pre-wrap;"><code>
{
  "name": "‡∏ß‡∏±‡∏¢‡∏ß‡∏≤‡∏¢",
  "date": "2025-06-15",
  "time": "18:00",
  "place": "‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏∞",
  "reason": "‡∏ô‡∏±‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏°‡∏±‡∏¢‡∏°‡∏±‡∏ò‡∏¢‡∏°"
}

Response:
{
  "id": 51,
  "message": "Request created successfully"
}
                                            </code></pre>
                                        </MudPaper>

                                        <MudText Typo="Typo.h6">PUT /requests/{id}/status</MudText>
                                        <MudText Typo="Typo.body2">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠ (Admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)</MudText>
                                        <MudPaper Class="pa-2" Style="background-color: #f5f5f5; font-family: 'Courier New', monospace;">
                                            <pre style="margin: 0; white-space: pre-wrap;"><code>
{
  "status": "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" // ‡∏´‡∏£‡∏∑‡∏≠ "‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï"
}

Response:
{
  "message": "Status updated successfully"
}
                                            </code></pre>
                                        </MudPaper>
                                    </MudStack>
                                </ChildContent>
                            </MudExpansionPanel>

                            <MudExpansionPanel>
                                <TitleContent>
                                    <div style="display: flex; align-items: center;">
                                        <MudIcon Icon="@Icons.Material.Filled.BarChart" class="mr-3" />
                                        <MudText>üìä Statistics API</MudText>
                                    </div>
                                </TitleContent>
                                <ChildContent>
                                    <MudStack Spacing="2">
                                        <MudText Typo="Typo.h6">GET /statistics/dashboard</MudText>
                                        <MudText Typo="Typo.body2">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin Dashboard</MudText>
                                        <MudPaper Class="pa-2" Style="background-color: #f5f5f5; font-family: 'Courier New', monospace;">
                                            <pre style="margin: 0; white-space: pre-wrap;"><code>
Response:
{
  "totalRequests": 50,
  "pendingRequests": 12,
  "approvedRequests": 28,
  "rejectedRequests": 10,
  "userStatistics": [
    {
      "username": "‡∏ß‡∏±‡∏¢‡∏ß‡∏≤‡∏¢",
      "total": 15,
      "pending": 3,
      "approved": 10,
      "rejected": 2
    }
  ]
}
                                            </code></pre>
                                        </MudPaper>
                                    </MudStack>
                                </ChildContent>
                            </MudExpansionPanel>
                        </MudExpansionPanels>
                    </MudStack>
                </MudTabPanel>

                <!-- Database Documentation Tab -->
                <MudTabPanel Text="üóÑÔ∏è Database Schema">
                    <MudStack Spacing="4">
                        <MudText Typo="Typo.h5" Color="Color.Primary">
                            Database Schema - ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏°‡∏µ‡∏¢
                        </MudText>

                        <MudAlert Severity="Severity.Info">
                            ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ JSON File Storage ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÅ‡∏ï‡πà‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Database ‡∏à‡∏£‡∏¥‡∏á ‡πÉ‡∏ä‡πâ Schema ‡∏ô‡∏µ‡πâ
                        </MudAlert>

                        <!-- Mermaid ERD -->
                        <MudPaper Class="pa-4" Elevation="2">
                            <MudText Typo="Typo.h6" Class="mb-3">üìã Entity Relationship Diagram</MudText>
                            <div id="mermaid-erd">
                                <pre class="mermaid">
erDiagram
    USERS {
        int id PK
        varchar username UK  
        varchar password
        varchar display_name
        varchar role
        datetime created_date
        datetime updated_date
    }
    REQUESTS {
        int id PK
        varchar name
        date request_date
        time request_time
        varchar place
        text reason
        varchar status
        datetime created_date
        datetime updated_date
        int created_by FK
        int approved_by FK
    }
    REQUEST_HISTORY {
        int id PK
        int request_id FK
        varchar old_status
        varchar new_status
        varchar changed_by
        datetime changed_date
        text comments
    }
    SESSIONS {
        int id PK
        int user_id FK
        varchar session_token
        datetime expires_at
        datetime created_date
    }
    USERS ||--o{ REQUESTS : creates
    USERS ||--o{ REQUEST_HISTORY : changes
    USERS ||--o{ SESSIONS : has
    REQUESTS ||--o{ REQUEST_HISTORY : tracks
                                </pre>
                            </div>
                        </MudPaper>

                        <!-- Tables Detail -->
                        <MudExpansionPanels Elevation="3">
                            <MudExpansionPanel>
                                <TitleContent>
                                    <div style="display: flex; align-items: center;">
                                        <MudIcon Icon="@Icons.Material.Filled.Person" class="mr-3" />
                                        <MudText>üë• USERS Table</MudText>
                                    </div>
                                </TitleContent>
                                <ChildContent>
                                    <MudSimpleTable Style="overflow-x: auto;">
                                        <thead>
                                            <tr>
                                                <th>Column</th>
                                                <th>Type</th>
                                                <th>Constraint</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr><td>id</td><td>INT</td><td>PRIMARY KEY, AUTO_INCREMENT</td><td>User ID</td></tr>
                                            <tr><td>username</td><td>VARCHAR(50)</td><td>UNIQUE, NOT NULL</td><td>Username ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö login</td></tr>
                                            <tr><td>password</td><td>VARCHAR(255)</td><td>NOT NULL</td><td>Password (hashed)</td></tr>
                                            <tr><td>display_name</td><td>VARCHAR(100)</td><td>NOT NULL</td><td>‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</td></tr>
                                            <tr><td>role</td><td>ENUM('‡πÄ‡∏°‡∏µ‡∏¢','‡∏™‡∏≤‡∏°‡∏µ','guest')</td><td>NOT NULL</td><td>‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</td></tr>
                                            <tr><td>created_date</td><td>DATETIME</td><td>DEFAULT CURRENT_TIMESTAMP</td><td>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á</td></tr>
                                            <tr><td>updated_date</td><td>DATETIME</td><td>ON UPDATE CURRENT_TIMESTAMP</td><td>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</td></tr>
                                        </tbody>
                                    </MudSimpleTable>
                                </ChildContent>
                            </MudExpansionPanel>

                            <MudExpansionPanel>
                                <TitleContent>
                                    <div style="display: flex; align-items: center;">
                                        <MudIcon Icon="@Icons.Material.Filled.Assignment" class="mr-3" />
                                        <MudText>üìù REQUESTS Table</MudText>
                                    </div>
                                </TitleContent>
                                <ChildContent>
                                    <MudSimpleTable Style="overflow-x: auto;">
                                        <thead>
                                            <tr>
                                                <th>Column</th>
                                                <th>Type</th>
                                                <th>Constraint</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr><td>id</td><td>INT</td><td>PRIMARY KEY, AUTO_INCREMENT</td><td>Request ID</td></tr>
                                            <tr><td>name</td><td>VARCHAR(100)</td><td>NOT NULL</td><td>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï</td></tr>
                                            <tr><td>request_date</td><td>DATE</td><td>NOT NULL</td><td>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ</td></tr>
                                            <tr><td>request_time</td><td>TIME</td><td>NOT NULL</td><td>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ</td></tr>
                                            <tr><td>place</td><td>VARCHAR(200)</td><td>NOT NULL</td><td>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</td></tr>
                                            <tr><td>reason</td><td>TEXT</td><td>NOT NULL</td><td>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</td></tr>
                                            <tr><td>status</td><td>ENUM('‡∏£‡∏≠','‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥','‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï')</td><td>DEFAULT '‡∏£‡∏≠'</td><td>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠</td></tr>
                                            <tr><td>created_date</td><td>DATETIME</td><td>DEFAULT CURRENT_TIMESTAMP</td><td>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠</td></tr>
                                            <tr><td>updated_date</td><td>DATETIME</td><td>ON UPDATE CURRENT_TIMESTAMP</td><td>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</td></tr>
                                            <tr><td>created_by</td><td>INT</td><td>FOREIGN KEY REFERENCES users(id)</td><td>‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠</td></tr>
                                            <tr><td>approved_by</td><td>INT</td><td>FOREIGN KEY REFERENCES users(id)</td><td>‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</td></tr>
                                        </tbody>
                                    </MudSimpleTable>
                                </ChildContent>
                            </MudExpansionPanel>

                            <MudExpansionPanel>
                                <TitleContent>
                                    <div style="display: flex; align-items: center;">
                                        <MudIcon Icon="@Icons.Material.Filled.History" class="mr-3" />
                                        <MudText>üìà REQUEST_HISTORY Table</MudText>
                                    </div>
                                </TitleContent>
                                <ChildContent>
                                    <MudSimpleTable Style="overflow-x: auto;">
                                        <thead>
                                            <tr>
                                                <th>Column</th>
                                                <th>Type</th>
                                                <th>Constraint</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr><td>id</td><td>INT</td><td>PRIMARY KEY, AUTO_INCREMENT</td><td>History ID</td></tr>
                                            <tr><td>request_id</td><td>INT</td><td>FOREIGN KEY REFERENCES requests(id)</td><td>Request ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</td></tr>
                                            <tr><td>old_status</td><td>VARCHAR(20)</td><td></td><td>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏î‡∏¥‡∏°</td></tr>
                                            <tr><td>new_status</td><td>VARCHAR(20)</td><td>NOT NULL</td><td>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà</td></tr>
                                            <tr><td>changed_by</td><td>VARCHAR(100)</td><td>NOT NULL</td><td>‡∏ú‡∏π‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</td></tr>
                                            <tr><td>changed_date</td><td>DATETIME</td><td>DEFAULT CURRENT_TIMESTAMP</td><td>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</td></tr>
                                            <tr><td>comments</td><td>TEXT</td><td></td><td>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</td></tr>
                                        </tbody>
                                    </MudSimpleTable>
                                </ChildContent>
                            </MudExpansionPanel>
                        </MudExpansionPanels>

                        <!-- Current JSON Structure -->
                        <MudPaper Class="pa-4" Elevation="2">
                            <MudText Typo="Typo.h6" Class="mb-3">üìÅ Current JSON File Structure</MudText>
                            <MudPaper Class="pa-2" Style="background-color: #f5f5f5; font-family: 'Courier New', monospace;">
                                <pre style="margin: 0; white-space: pre-wrap;"><code>
{
  "Requests": [
    {
      "Id": 1,
      "Name": "‡∏ß‡∏±‡∏¢‡∏ß‡∏≤‡∏¢",
      "Date": "2025-06-15",
      "Time": "18:00",
      "Place": "‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏∞",
      "Reason": "‡∏ô‡∏±‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏°‡∏±‡∏¢‡∏°‡∏±‡∏ò‡∏¢‡∏°",
      "Status": "‡∏£‡∏≠",
      "CreatedDate": "2025-06-14T10:00:00"
    }
  ],
  "NextId": 51
}
                                </code></pre>
                            </MudPaper>
                        </MudPaper>
                    </MudStack>
                </MudTabPanel>

                <!-- System Flow Tab -->
                <MudTabPanel Text="üîÑ System Flow">
                    <MudStack Spacing="4">
                        <MudText Typo="Typo.h5" Color="Color.Primary">
                            System Flow & User Roles - ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏°‡∏µ‡∏¢
                        </MudText>

                        <!-- Roles Overview -->
                        <MudGrid>
                            <MudItem xs="12" md="4">
                                <MudPaper Class="pa-4" Elevation="2" Style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">
                                    <MudStack AlignItems="AlignItems.Center" Spacing="2">
                                        <MudIcon Icon="@Icons.Material.Filled.AdminPanelSettings" Size="Size.Large" Color="Color.Secondary" />
                                        <MudText Typo="Typo.h6" Align="Align.Center">üëë ‡πÄ‡∏°‡∏µ‡∏¢ (Admin)</MudText>
                                        <MudText Typo="Typo.body2" Align="Align.Center">
                                            ‡∏ú‡∏π‡πâ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏∞‡∏ö‡∏ö<br/>
                                            ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏ï‡πá‡∏°
                                        </MudText>
                                    </MudStack>
                                </MudPaper>
                            </MudItem>

                            <MudItem xs="12" md="4">
                                <MudPaper Class="pa-4" Elevation="2" Style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                                    <MudStack AlignItems="AlignItems.Center" Spacing="2">
                                        <MudIcon Icon="@Icons.Material.Filled.Person" Size="Size.Large" Color="Color.Primary" />
                                        <MudText Typo="Typo.h6" Align="Align.Center">üë® ‡∏™‡∏≤‡∏°‡∏µ (User)</MudText>
                                        <MudText Typo="Typo.body2" Align="Align.Center">
                                            ‡∏ú‡∏π‡πâ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï<br/>
                                            ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏à‡∏≥‡∏Å‡∏±‡∏î
                                        </MudText>
                                    </MudStack>
                                </MudPaper>
                            </MudItem>

                            <MudItem xs="12" md="4">
                                <MudPaper Class="pa-4" Elevation="2" Style="background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);">
                                    <MudStack AlignItems="AlignItems.Center" Spacing="2">
                                        <MudIcon Icon="@Icons.Material.Filled.PersonOutline" Size="Size.Large" Color="Color.Default" />
                                        <MudText Typo="Typo.h6" Align="Align.Center">üë§ Guest</MudText>
                                        <MudText Typo="Typo.body2" Align="Align.Center">
                                            ‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°<br/>
                                            ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
                                        </MudText>
                                    </MudStack>
                                </MudPaper>
                            </MudItem>
                        </MudGrid>

                        <!-- System Flow Diagram -->
                        <MudPaper Class="pa-4" Elevation="2">
                            <MudText Typo="Typo.h6" Class="mb-3">üîÑ System Flow Diagram</MudText>
                            <div id="mermaid-flow">
                                <pre class="mermaid">
flowchart TD
    A[User Access] --> B{Authentication}
    B -->|No Login| C[Home Page]
    B -->|Login Success| D{Check Role}
    D -->|Wife| E[Admin Dashboard]
    D -->|Husband| F[User Dashboard]
    D -->|Guest| G[Limited Access]
    C --> H[Login Page]
    H --> I[Request Form]
    E --> J[View All Requests]
    E --> K[Approve Reject]
    F --> N[My Requests]
    F --> O[Create New Request]
    I --> Q[Submit Request]
    Q --> R[Store in JSON]
    J --> T{Decision}
    T -->|Approve| U[Status Approved]
    T -->|Reject| V[Status Rejected]
    U --> W[Update JSON]
    V --> W
                                </pre>
                            </div>
                        </MudPaper>

                        <!-- Role Permissions -->
                        <MudExpansionPanels Elevation="3">
                            <MudExpansionPanel>
                                <TitleContent>
                                    <div style="display: flex; align-items: center;">
                                        <MudIcon Icon="@Icons.Material.Filled.Security" class="mr-3" />
                                        <MudText>üîê Role Permissions</MudText>
                                    </div>
                                </TitleContent>
                                <ChildContent>
                                    <MudGrid>
                                        <MudItem xs="12" md="4">
                                            <MudPaper Class="pa-3" Elevation="1" Style="border-left: 4px solid #e91e63;">
                                                <MudText Typo="Typo.h6" Color="Color.Secondary">üëë ‡πÄ‡∏°‡∏µ‡∏¢ (Admin)</MudText>
                                                <MudList T="string" Dense="true">
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
                                                        ‡∏î‡∏π‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                                                    </MudListItem>
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
                                                        ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Ñ‡∏≥‡∏Ç‡∏≠
                                                    </MudListItem>
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
                                                        ‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏∞‡∏ö‡∏ö
                                                    </MudListItem>
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
                                                        ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Documentation
                                                    </MudListItem>
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
                                                        ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Future)
                                                    </MudListItem>
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
                                                        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
                                                    </MudListItem>
                                                </MudList>
                                            </MudPaper>
                                        </MudItem>

                                        <MudItem xs="12" md="4">
                                            <MudPaper Class="pa-3" Elevation="1" Style="border-left: 4px solid #2196f3;">
                                                <MudText Typo="Typo.h6" Color="Color.Primary">üë® ‡∏™‡∏≤‡∏°‡∏µ (User)</MudText>
                                                <MudList T="string" Dense="true">
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
                                                        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
                                                    </MudListItem>
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
                                                        ‡∏î‡∏π‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏ï‡∏ô‡πÄ‡∏≠‡∏á
                                                    </MudListItem>
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
                                                        ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠
                                                    </MudListItem>
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.Cancel" IconColor="Color.Error">
                                                        ‡∏î‡∏π‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô
                                                    </MudListItem>
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.Cancel" IconColor="Color.Error">
                                                        ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥/‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Ñ‡∏≥‡∏Ç‡∏≠
                                                    </MudListItem>
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.Cancel" IconColor="Color.Error">
                                                        ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Admin Panel
                                                    </MudListItem>
                                                </MudList>
                                            </MudPaper>
                                        </MudItem>

                                        <MudItem xs="12" md="4">
                                            <MudPaper Class="pa-3" Elevation="1" Style="border-left: 4px solid #9e9e9e;">
                                                <MudText Typo="Typo.h6" Color="Color.Default">üë§ Guest</MudText>
                                                <MudList T="string" Dense="true">
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
                                                        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á Login)
                                                    </MudListItem>
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
                                                        ‡∏î‡∏π‡∏´‡∏ô‡πâ‡∏≤ Home
                                                    </MudListItem>
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.CheckCircle" IconColor="Color.Success">
                                                        ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                                                    </MudListItem>
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.Cancel" IconColor="Color.Error">
                                                        ‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠
                                                    </MudListItem>
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.Cancel" IconColor="Color.Error">
                                                        ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Dashboard
                                                    </MudListItem>
                                                    <MudListItem T="string" Icon="@Icons.Material.Filled.Cancel" IconColor="Color.Error">
                                                        ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠
                                                    </MudListItem>
                                                </MudList>
                                            </MudPaper>
                                        </MudItem>
                                    </MudGrid>
                                </ChildContent>
                            </MudExpansionPanel>

                            <MudExpansionPanel>
                                <TitleContent>
                                    <div style="display: flex; align-items: center;">
                                        <MudIcon Icon="@Icons.Material.Filled.Route" class="mr-3" />
                                        <MudText>üó∫Ô∏è Page Routes & Access</MudText>
                                    </div>
                                </TitleContent>
                                <ChildContent>
                                    <MudSimpleTable Style="overflow-x: auto;">
                                        <thead>
                                            <tr>
                                                <th>Route</th>
                                                <th>Page</th>
                                                <th>Layout</th>
                                                <th>‡πÄ‡∏°‡∏µ‡∏¢</th>
                                                <th>‡∏™‡∏≤‡∏°‡∏µ</th>
                                                <th>Guest</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>/</td>
                                                <td>Home</td>
                                                <td>FullPage</td>
                                                <td>‚úÖ</td>
                                                <td>‚úÖ</td>
                                                <td>‚úÖ</td>
                                                <td>‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</td>
                                            </tr>
                                            <tr>
                                                <td>/login</td>
                                                <td>Login</td>
                                                <td>FullPage</td>
                                                <td>‚úÖ</td>
                                                <td>‚úÖ</td>
                                                <td>‚úÖ</td>
                                                <td>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</td>
                                            </tr>
                                            <tr>
                                                <td>/request</td>
                                                <td>Request Form</td>
                                                <td>FullPage</td>
                                                <td>‚úÖ</td>
                                                <td>‚úÖ</td>
                                                <td>‚úÖ</td>
                                                <td>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á Login)</td>
                                            </tr>
                                            <tr>
                                                <td>/request-logged-in</td>
                                                <td>Request Form</td>
                                                <td>MainLayout</td>
                                                <td>‚úÖ</td>
                                                <td>‚úÖ</td>
                                                <td>‚ùå</td>
                                                <td>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï (Login ‡πÅ‡∏•‡πâ‡∏ß)</td>
                                            </tr>
                                            <tr>
                                                <td>/dashboard</td>
                                                <td>User Dashboard</td>
                                                <td>MainLayout</td>
                                                <td>‚úÖ</td>
                                                <td>‚úÖ</td>
                                                <td>‚ùå</td>
                                                <td>Dashboard ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</td>
                                            </tr>
                                            <tr>
                                                <td>/admin</td>
                                                <td>Admin Panel</td>
                                                <td>MainLayout</td>
                                                <td>‚úÖ</td>
                                                <td>‚ùå</td>
                                                <td>‚ùå</td>
                                                <td>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
                                            </tr>
                                            <tr>
                                                <td>/docs</td>
                                                <td>Documentation</td>
                                                <td>MainLayout</td>
                                                <td>‚úÖ</td>
                                                <td>‚ùå</td>
                                                <td>‚ùå</td>
                                                <td>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö</td>
                                            </tr>
                                        </tbody>
                                    </MudSimpleTable>
                                </ChildContent>
                            </MudExpansionPanel>

                            <MudExpansionPanel>
                                <TitleContent>
                                    <div style="display: flex; align-items: center;">
                                        <MudIcon Icon="@Icons.Material.Filled.Timeline" class="mr-3" />
                                        <MudText>üìã Request Lifecycle</MudText>
                                    </div>
                                </TitleContent>
                                <ChildContent>
                                    <MudPaper Class="pa-4" Elevation="1">
                                        <div id="mermaid-lifecycle">
                                            <pre class="mermaid">
stateDiagram-v2
    [*] --> CreateRequest : User sends form
    CreateRequest --> Pending : Status equals Waiting
    Pending --> Approved : Wife approves
    Pending --> Rejected : Wife rejects
    Approved --> [*] : Husband can go out
    Rejected --> [*] : Husband cannot go out
                                            </pre>
                                        </div>
                                    </MudPaper>
                                </ChildContent>
                            </MudExpansionPanel>
                        </MudExpansionPanels>

                        <!-- Technology Stack -->
                        <MudPaper Class="pa-4" Elevation="2">
                            <MudText Typo="Typo.h6" Class="mb-3">üîß Technology Stack</MudText>
                            <MudGrid>
                                <MudItem xs="12" md="6">
                                    <MudText Typo="Typo.subtitle1" Color="Color.Primary">Frontend:</MudText>
                                    <MudList T="string" Dense="true">
                                        <MudListItem T="string" Icon="@Icons.Material.Filled.Web">Blazor Server (.NET 8)</MudListItem>
                                        <MudListItem T="string" Icon="@Icons.Material.Filled.Palette">MudBlazor UI Framework</MudListItem>
                                        <MudListItem T="string" Icon="@Icons.Material.Filled.DevicesOther">Responsive CSS</MudListItem>
                                        <MudListItem T="string" Icon="@Icons.Material.Filled.Animation">Custom Modal Components</MudListItem>
                                    </MudList>
                                </MudItem>
                                <MudItem xs="12" md="6">
                                    <MudText Typo="Typo.subtitle1" Color="Color.Primary">Backend:</MudText>
                                    <MudList T="string" Dense="true">
                                        <MudListItem T="string" Icon="@Icons.Material.Filled.Storage">JSON File Storage</MudListItem>
                                        <MudListItem T="string" Icon="@Icons.Material.Filled.Security">Custom Authentication</MudListItem>
                                        <MudListItem T="string" Icon="@Icons.Material.Filled.Api">RESTful-like Services</MudListItem>
                                        <MudListItem T="string" Icon="@Icons.Material.Filled.Memory">In-Memory State Management</MudListItem>
                                    </MudList>
                                </MudItem>
                            </MudGrid>
                        </MudPaper>
                    </MudStack>
                </MudTabPanel>
            </MudTabs>
        </MudStack>
    </MudPaper>
</MudContainer>

<!-- Load Mermaid.js from CDN (required for the module) -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>

@code {
    private IJSObjectReference? mermaidModule;
    private int activeTabIndex = 0;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                // Wait for mermaid library to load
                await Task.Delay(2000);
                
                // Import the JavaScript module
                mermaidModule = await JSRuntime.InvokeAsync<IJSObjectReference>(
                    "import", "/modules/mermaidmodule.js");
                
                // Initialize mermaid
                var initResult = await mermaidModule.InvokeAsync<bool>("Initialize");
                Console.WriteLine($"Mermaid init result: {initResult}");
                
                if (initResult)
                {
                    await Task.Delay(500);
                    // Render diagrams
                    var renderResult = await mermaidModule.InvokeAsync<bool>("Render", "mermaid");
                    Console.WriteLine($"Mermaid render result: {renderResult}");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Mermaid module error: {ex.Message}");
            }
        }
        else if (mermaidModule != null)
        {
            try
            {
                // Re-render on subsequent renders
                await mermaidModule.InvokeVoidAsync("Render", "mermaid");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Mermaid re-render error: {ex.Message}");
            }
        }
        
        await base.OnAfterRenderAsync(firstRender);
    }

    private async Task OnTabChanged(int newIndex)
    {
        activeTabIndex = newIndex;
        StateHasChanged(); // Force re-render
        
        // Wait for the tab content to render, then re-render mermaid diagrams
        await Task.Delay(1000); // ‡πÄ‡∏û‡∏¥‡πà‡∏° delay ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠
        
        if (mermaidModule != null)
        {
            try
            {
                // Reset processing state for fresh rendering
                await mermaidModule.InvokeAsync<bool>("ResetProcessing", "mermaid");
                await Task.Delay(200);
                
                var renderResult = await mermaidModule.InvokeAsync<bool>("Render", "mermaid");
                Console.WriteLine($"Tab {newIndex} - Mermaid render result: {renderResult}");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Tab change mermaid error: {ex.Message}");
            }
        }
    }

    public async ValueTask DisposeAsync()
    {
        if (mermaidModule != null)
        {
            try
            {
                await mermaidModule.DisposeAsync();
            }
            catch (JSDisconnectedException)
            {
                // Expected when circuit is being disposed
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error disposing mermaid module: {ex.Message}");
            }
        }
    }
}